<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Jeopardy Quiz Master</title>
<link rel="stylesheet" href="quiz.css">
</head>
<body>
<div class="container">
    <header>
        <h1>Jeopardy Quiz Master</h1>
        <div id="currentPlayer">Aktiver Spieler: -</div>
        <div id="timerDisplay">Timer: 0</div>
    </header>

    <section class="board" id="board"></section>

    <section class="controls" id="controls">
        <button id="startTimerBtn">Timer starten</button>
        <button id="resetTimerBtn">Timer zurücksetzen</button>
        <button onclick="window.open('/board-editor.html','_blank','width=1000,height=700')">Board Editor öffnen</button>
    </section>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();
let currentQuestion = null;

// Board laden
socket.emit("getBoard");
socket.on("boardData", board => renderBoard(board));

// Board rendern
function renderBoard(board) {
    const boardEl = document.getElementById("board");
    boardEl.innerHTML = "";
    board.categories.forEach((cat, cIndex) => {
        const col = document.createElement("div");
        col.className = "column";
        const catTitle = document.createElement("div");
        catTitle.className = "category";
        catTitle.innerText = cat.name;
        col.appendChild(catTitle);

        cat.questions.forEach((q, qIndex) => {
            const btn = document.createElement("button");
            btn.className = "questionBtn";
            btn.innerText = q.value;
            btn.onclick = () => selectQuestion(cIndex, qIndex);
            col.appendChild(btn);
        });
        boardEl.appendChild(col);
    });
}

// Frage auswählen
function selectQuestion(cIndex, qIndex) {
    socket.emit("selectQuestion", { categoryIndex: cIndex, questionIndex: qIndex, admin: true });
}

// Frage vom Server
socket.on("questionSelected", q => {
    currentQuestion = q;
    document.getElementById("timerDisplay").innerText = "Timer: " + q.timer;
    alert(`Frage: ${q.question}\nAntwort: ${q.answer}`);
});

// Timer
document.getElementById("startTimerBtn").addEventListener("click", () => {
    if(!currentQuestion) return alert("Bitte zuerst eine Frage auswählen!");
    socket.emit("startTimer");
});
document.getElementById("resetTimerBtn").addEventListener("click", () => {
    if(currentQuestion) document.getElementById("timerDisplay").innerText = "Timer: " + currentQuestion.timer;
});

// Timer Updates
socket.on("timerUpdate", t => { document.getElementById("timerDisplay").innerText = "Timer: " + t; });
socket.on("timerEnded", () => alert("Zeit abgelaufen!"));

// Buzz Updates
socket.on("buzzUpdate", player => {
    document.getElementById("currentPlayer").innerText = "Aktiver Spieler: " + player;
});
</script>
</body>
</html>
