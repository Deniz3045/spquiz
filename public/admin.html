<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Jeopardy Admin Panel</title>
<link rel="stylesheet" href="admin.css">
</head>
<body>
<div class="container">
    <header>
        <h1>Admin Panel</h1>
        <div class="header-buttons">
            <button onclick="openEditor()">Board Editor öffnen</button>
            <button onclick="startQuiz()">Quiz starten</button>
        </div>
    </header>

    <!-- Spielerverwaltung -->
    <section class="player-management">
        <h2>Spielerverwaltung</h2>
        <input id="newUsername" placeholder="Username">
        <input id="newPassword" placeholder="Passwort">
        <select id="newRole">
            <option value="player">Spieler</option>
            <option value="editor">Editor</option>
            <option value="admin">Admin</option>
        </select>
        <button id="addPlayerBtn">Hinzufügen</button>

        <table>
            <thead>
                <tr><th>Username</th><th>Role</th><th>Punkte</th><th>Aktionen</th></tr>
            </thead>
            <tbody id="playersList"></tbody>
        </table>
    </section>

    <!-- Board Auswahl -->
    <section class="board-management">
        <h2>Boards</h2>
        <select id="boardSelect"></select>
        <button onclick="loadBoard()">Board laden</button>
    </section>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();
let users = [];

// Spieler laden
async function loadPlayers(){
    const res = await fetch("/api/users");
    users = await res.json();
    renderPlayers();
}

function renderPlayers(){
    const tbody = document.getElementById("playersList");
    tbody.innerHTML="";
    users.forEach(u=>{
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${u.username}</td>
                        <td>${u.role}</td>
                        <td>${u.score}</td>
                        <td>
                            <button onclick="deletePlayer('${u.username}')">Löschen</button>
                        </td>`;
        tbody.appendChild(tr);
    });
}

async function deletePlayer(username){
    await fetch("/api/users/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username})});
    await loadPlayers();
}

// Spieler hinzufügen
document.getElementById("addPlayerBtn").addEventListener("click", async ()=>{
    const username=document.getElementById("newUsername").value.trim();
    const password=document.getElementById("newPassword").value.trim();
    const role=document.getElementById("newRole").value;
    if(!username||!password) return alert("Username und Passwort angeben!");
    await fetch("/api/users/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username,password,role})});
    document.getElementById("newUsername").value="";
    document.getElementById("newPassword").value="";
    await loadPlayers();
});

// Boards laden
async function loadBoards(){
    const res = await fetch("/api/boards/files");
    const boards = await res.json();
    const select = document.getElementById("boardSelect");
    select.innerHTML="";
    boards.forEach(b=>{
        const opt=document.createElement("option");
        opt.value=b.file;
        opt.innerText=b.file;
        select.appendChild(opt);
    });
}

// Board Editor öffnen
function openEditor(){
    window.open("/board-editor.html","_blank","width=1000,height=700");
}

// Board laden
function loadBoard(){
    const file = document.getElementById("boardSelect").value;
    if(file) socket.emit("loadBoard",{fileName:file});
}

// Quiz starten
function startQuiz(){
    window.open("/quiz.html","_blank","width=1200,height=800");
}

// Live Punkte Update
socket.on("scoreUpdate", updatedUsers=>{
    users = updatedUsers;
    renderPlayers();
});

// Init
loadPlayers();
loadBoards();
</script>
</body>
</html>
