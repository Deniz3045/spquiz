<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Quiz Admin Panel</title>
<link rel="stylesheet" href="css/admin.css">
</head>
<body>

<h1>Quiz Admin Panel</h1>

<div class="section">

<h2>Spieler erstellen</h2>

<input id="username" placeholder="Username">
<input id="password" placeholder="Password">

<select id="role">
<option value="player">Player</option>
<option value="editor">Editor</option>
<option value="admin">Admin</option>
</select>

<button onclick="createUser()">Erstellen</button>

</div>


<div class="section">

<h2>Spieler Liste</h2>

<table>
<thead>
<tr>
<th>Name</th>
<th>Role</th>
<th>Score</th>
<th>Aktionen</th>
</tr>
</thead>

<tbody id="usersTable"></tbody>

</table>

</div>


<div class="section">

<h2>Boards</h2>

<select id="boardSelect"></select>

<button onclick="selectBoard()">Board aktivieren</button>

<button onclick="openEditor()">Board Editor</button>

<button onclick="startQuiz()">Quiz starten</button>

</div>


<script src="/socket.io/socket.io.js"></script>

<script>

const socket = io();


// USERS LADEN
async function loadUsers(){

const res = await fetch("/api/users");

const users = await res.json();

const table = document.getElementById("usersTable");

table.innerHTML="";

users.forEach(user=>{

table.innerHTML+=`

<tr>

<td>${user.username}</td>

<td>
<select onchange="updateUser('${user.username}', this.value, null)">
<option value="player" ${user.role=="player"?"selected":""}>player</option>
<option value="editor" ${user.role=="editor"?"selected":""}>editor</option>
<option value="admin" ${user.role=="admin"?"selected":""}>admin</option>
</select>
</td>

<td>
<input type="number" value="${user.score}"
onchange="updateUser('${user.username}', null, this.value)">
</td>

<td>
<button onclick="deleteUser('${user.username}')">LÃ¶schen</button>
</td>

</tr>

`;

});

}


// USER ERSTELLEN
async function createUser(){

await fetch("/api/users/create",{

method:"POST",
headers:{"Content-Type":"application/json"},

body:JSON.stringify({

username:document.getElementById("username").value,

password:document.getElementById("password").value,

role:document.getElementById("role").value

})

});

loadUsers();

}


// USER UPDATE
async function updateUser(username, role, score){

await fetch("/api/users/update",{

method:"POST",

headers:{"Content-Type":"application/json"},

body:JSON.stringify({

username,
role,
score

})

});

}


// USER DELETE
async function deleteUser(username){

await fetch("/api/users/delete",{

method:"POST",

headers:{"Content-Type":"application/json"},

body:JSON.stringify({username})

});

loadUsers();

}



// BOARDS LADEN
async function loadBoards(){

const res = await fetch("/api/boards");

const boards = await res.json();

const select = document.getElementById("boardSelect");

select.innerHTML="";

Object.keys(boards).forEach(name=>{

select.innerHTML+=`<option value="${name}">${name}</option>`;

});

}


// BOARD AKTIVIEREN
async function selectBoard(){

await fetch("/api/boards/select",{

method:"POST",

headers:{"Content-Type":"application/json"},

body:JSON.stringify({

name:document.getElementById("boardSelect").value

})

});

alert("Board aktiviert");

}


// EDITOR
function openEditor(){

window.open("/board-editor.html","_blank");

}


// QUIZ START
function startQuiz(){

window.open("/quiz.html","_blank");

}


// LIVE UPDATE
socket.on("usersUpdated", loadUsers);


// INIT
loadUsers();
loadBoards();

</script>

</body>
</html>
