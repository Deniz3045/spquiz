<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Jeopardy Board</title>
<script src="/socket.io/socket.io.js"></script>

<style>
body{
  font-family:'Arial', sans-serif;
  margin:0;
  padding:0;
  background:#0b1e2d;
  color:white;
}

header{
  background:#1b3a57;
  padding:15px;
  text-align:center;
  font-size:24px;
  color:#00c3ff;
  font-weight:bold;
}

#scoreboard{
  display:flex;
  justify-content:center;
  margin:10px 0;
  font-size:18px;
}

#scoreboard div{
  margin:0 20px;
  padding:5px 10px;
  background:rgba(255,255,255,0.1);
  border-radius:5px;
}

#board{
  display:grid;
  grid-template-columns: repeat(5, 1fr);
  gap:5px;
  max-width:1000px;
  margin:20px auto;
}

.category{
  background:#145374;
  text-align:center;
  padding:10px;
  font-weight:bold;
  font-size:18px;
  border-radius:5px;
}

.question-btn{
  background:#1e6091;
  color:white;
  font-size:20px;
  padding:20px;
  border:none;
  border-radius:5px;
  cursor:pointer;
  transition:0.3s;
}

.question-btn:hover{
  transform: scale(1.05);
  background:#00c3ff;
}

#questionModal{
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:rgba(0,0,0,0.85);
  display:none;
  justify-content:center;
  align-items:center;
  flex-direction:column;
  text-align:center;
}

#questionModal p{
  font-size:24px;
  margin-bottom:20px;
}

#questionModal button{
  padding:15px 30px;
  margin:5px;
  font-size:18px;
  border:none;
  border-radius:5px;
  cursor:pointer;
  background:#00c3ff;
  color:white;
  transition:0.3s;
}

#questionModal button:hover{
  transform: scale(1.05);
  background:#0099cc;
}

#timer{
  font-size:22px;
  margin-bottom:10px;
  color:#ffcc00;
}

#buzzBtn{
  background:#e63946;
}

#buzzBtn:hover{
  background:#ff4d6d;
}
</style>
</head>
<body>

<header>Jeopardy Board</header>

<div id="scoreboard">
  <div id="score1">Spieler1: 0</div>
  <div id="score2">Spieler2: 0</div>
  <div id="score3">Spieler3: 0</div>
</div>

<div id="board"></div>

<!-- Question Modal -->
<div id="questionModal">
  <div id="timer"></div>
  <p id="questionText"></p>
  <div>
    <button onclick="answer(true)">Richtig</button>
    <button onclick="answer(false)">Falsch</button>
    <button id="buzzBtn" onclick="buzz()">Buzz!</button>
  </div>
</div>

<script>
const socket = io();
let username = localStorage.getItem("username");
let role = localStorage.getItem("role");
let currentQuestion = null;

// Scoreboard Daten
let users = [
  {username:"Spieler1",score:0},
  {username:"Spieler2",score:0},
  {username:"Spieler3",score:0}
];

function renderScores(){
  users.forEach((u,i)=>{
    const el = document.getElementById("score"+(i+1));
    if(el) el.innerText = u.username+": "+u.score;
  });
}

// --- Board aufbauen ---
socket.emit("getBoard");

socket.on("boardData",(board)=>{
  const boardDiv = document.getElementById("board");
  boardDiv.innerHTML = "";

  // Kategorien
  board.categories.forEach((cat,index)=>{
    const catDiv = document.createElement("div");
    catDiv.className="category";
    catDiv.innerText=cat.name;
    boardDiv.appendChild(catDiv);
  });

  // Fragen
  for(let q=0;q<5;q++){
    board.categories.forEach((cat,index)=>{
      const question = cat.questions[q];
      const btn = document.createElement("button");
      btn.className="question-btn";
      btn.innerText = question.value;
      btn.onclick = ()=>{
        if(role==="admin") socket.emit("selectQuestion",{categoryIndex:index,questionIndex:q,admin:true});
      };
      boardDiv.appendChild(btn);
    });
  }
});

// --- Frage Modal ---
socket.on("questionSelected",(q)=>{
  currentQuestion = q;
  document.getElementById("questionText").innerText = q.text;
  document.getElementById("questionModal").style.display="flex";
  document.getElementById("timer").innerText = "Timer: "+q.timer;
  socket.emit("startTimer");
});

// Timer update
socket.on("timerUpdate",(t)=>{
  document.getElementById("timer").innerText="Timer: "+t;
});

socket.on("timerEnded",()=>{
  document.getElementById("questionModal").style.display="none";
});

// Buzz Funktion
function buzz(){
  socket.emit("buzz", username);
  document.getElementById("buzzBtn").disabled=true;
}

// Antwort Funktion
function answer(correct){
  socket.emit("answer",{username,correct});
  document.getElementById("questionModal").style.display="none";
}

// Score Update
socket.on("scoreUpdate",(data)=>{
  users = data;
  renderScores();
});

// Buzz Update
socket.on("buzzUpdate",(player)=>{
  document.getElementById("timer").innerText="Aktiver Spieler: "+player;
});

renderScores();
</script>
</body>
</html>
