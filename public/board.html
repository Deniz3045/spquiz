<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Jeopardy Spieler</title>
<script src="/socket.io/socket.io.js"></script>
<link rel="stylesheet" href="quiz.css">
</head>
<body>
<h1>Jeopardy Quiz</h1>
<div id="scoreboard"></div>
<div id="board"></div>
<div id="questionWindow" class="hidden">
  <h2 id="questionCategory"></h2>
  <p id="questionText"></p>
  <p>Wert: <span id="questionValue"></span></p>
  <button id="buzzBtn" disabled>Buzz!</button>
  <p id="timerDisplay"></p>
</div>

<script>
const socket = io();
let username, role;

socket.on('connect', ()=>{
  username = prompt("Benutzername:");
  let password = prompt("Passwort:");
  socket.emit('login',{username,password});
});

socket.on('loginSuccess', data=>{
  username=data.username; role=data.role;
  alert(`Willkommen ${username} (${role})`);
  socket.emit('getBoard');
  socket.emit('getUsers');
});

socket.on('loginFail', msg=>alert(msg));

const scoreboard=document.getElementById('scoreboard');
socket.on('scoreUpdate', users=>{
  scoreboard.innerHTML="<h3>Punkte</h3>";
  users.forEach(u=>{
    const div=document.createElement('div');
    div.textContent=`${u.username}: ${u.score}`;
    scoreboard.appendChild(div);
  });
});

const boardDiv=document.getElementById('board');
socket.on('boardData', board=>{
  boardDiv.innerHTML='';
  board.categories.forEach((cat,ci)=>{
    const col=document.createElement('div'); col.className='category';
    const h=document.createElement('h3'); h.textContent=cat.name; col.appendChild(h);
    cat.questions.forEach((q,qi)=>{
      const btn=document.createElement('button');
      btn.textContent=q.value;
      btn.disabled=true;
      col.appendChild(btn);
    });
    boardDiv.appendChild(col);
  });
});

const questionWindow=document.getElementById('questionWindow');
const questionCategory=document.getElementById('questionCategory');
const questionText=document.getElementById('questionText');
const questionValue=document.getElementById('questionValue');
const timerDisplay=document.getElementById('timerDisplay');
const buzzBtn=document.getElementById('buzzBtn');

socket.on('questionSelected', q=>{
  questionWindow.classList.remove('hidden');
  questionCategory.textContent=q.category||'';
  questionText.textContent=q.text;
  questionValue.textContent=q.value;
  buzzBtn.disabled=true;
});
socket.on('buzzersUnlocked', ()=>buzzBtn.disabled=false);
buzzBtn.onclick = ()=>socket.emit('buzz', username);

socket.on('timerUpdate', t=>timerDisplay.textContent=`Timer: ${t}`);
socket.on('timerEnded', ()=>timerDisplay.textContent="Zeit abgelaufen!");
socket.on('buzzUpdate', user=>alert(`${user} hat gebuzzt!`));
</script>
</body>
</html>
